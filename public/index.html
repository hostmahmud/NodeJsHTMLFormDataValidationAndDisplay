<!DOCTYPE html>
<html>
<head>
	<title>Application form</title>
	<link rel="stylesheet" type="text/css" href="main.css">
	<script src="Scripts/jquery-3.5.1.min.js"></script>

    <script type="text/javascript">
       //START VALIDATION
        function printError(elemId, hintMsg) {
            document.getElementById(elemId).innerHTML = hintMsg;
        }
        function validateForm() {
            // Retrieving the values of form elements 
            var eid = document.frmNodeSubmit.eid.value;
            var fname = document.frmNodeSubmit.fname.value;
            var lname = document.frmNodeSubmit.lname.value;
            var phone = document.frmNodeSubmit.phone.value;
            var email = document.frmNodeSubmit.email.value;
            var city = document.frmNodeSubmit.city.value;
            var country = document.frmNodeSubmit.country.value;
            var gender = document.frmNodeSubmit.gender.value;
            var birthday = document.frmNodeSubmit.birthday.value;
            var photo = document.frmNodeSubmit.photo.value;
            var hobbies = [];
            var checkboxes = document.getElementsByName("hobbies[]");
            for(var i=0; i < checkboxes.length; i++) {
                if(checkboxes[i].checked) {
                    // Populate hobbies array with selected values
                    hobbies.push(checkboxes[i].value);
                }
            }
            
            var eidErr = fnameErr = lnameErr = phoneErr = emailErr = cityErr = countryErr = birthdayErr = photoErr = true;
            
            // Validate id
            if(eid == "") {
                printError("eidErr", "Please enter ID number");
            } else {
                var regex = /^[0-9]\d{5}$/;                
                if(regex.test(eid) === false) {
                    printError("eidErr", "Please enter a 6 digit ID number");
                } else {
                    printError("eidErr", "");
                    eidErr = false;
                }
            }
            // Validate first name
            if(fname == "") {
                printError("fnameErr", "Please enter first name");
            } else {
                var regex = /^[a-zA-Z\s]+$/;                
                if(regex.test(fname) === false) {
                    printError("fnameErr", "Please enter a valid first name");
                } else {
                    printError("fnameErr", "");
                    fnameErr = false;
                }
            }
            // Validate last name
            if(lname == "") {
                printError("lnameErr", "Please enter last name");
            } else {
                var regex = /^[a-zA-Z\s]+$/;                
                if(regex.test(lname) === false) {
                    printError("lnameErr", "Please enter a valid last name");
                } else {
                    printError("lnameErr", "");
                    lnameErr = false;
                }
            }
            // Validate phone number
            if(phone == "") {
                printError("phoneErr", "Please enter your phone number");
            } else {
                var regex = /^[0-9]\d{10}$/;
                if(regex.test(phone) === false) {
                    printError("phoneErr", "Please enter a valid 11 digit phone number");
                } else{
                    printError("phoneErr", "");
                    phoneErr = false;
                }
            }
            // Validate email address
            if(email == "") {
                printError("emailErr", "Please enter your email address");
            } else {
                // Regular expression for basic email validation
                var regex = /^\S+@\S+\.\S+$/;
                if(regex.test(email) === false) {
                    printError("emailErr", "Please enter a valid email address");
                } else{
                    printError("emailErr", "");
                    emailErr = false;
                }
            }
            // Validate city
            if(city == "Select") {
                printError("cityErr", "Please select your city");
            } else {
                printError("cityErr", "");
                cityErr = false;
            }
            // Validate country
            if(country == "") {
                printError("countryErr", "Please select your country");
            } else {
                printError("countryErr", "");
                countryErr = false;
            }
            // Validate gender
            if(gender == "") {
                printError("genderErr", "Please select your gender");
            } else {
                printError("genderErr", "");
                genderErr = false;
            }
            // Validate birthday
            if(birthday == "") {
                printError("birthdayErr", "Please enter birthday");
            } else {
                printError("birthdayErr", "");
                birthdayErr = false;
            }
            //validate uploaded photo
            // Validate birthday
            if(photo == "") {
                printError("photoErr", "Please select a photo (.jpg, .png, .jpeg)");
            } else {
                printError("photoErr", "");
                photoErr = false;
            }
        
            if((eidErr || fnameErr || lnameErr || phoneErr || emailErr || cityErr || countryErr || birthdayErr || photoErr) == true) {
               return false;
            } else {
                if(hobbies.length) {
                    var hby = hobbies.join(", ");
                }
                $.ajax({
                    url:"/nodesubmit",
                    type:'POST',
                    data:$("#frmNodeSubmit").serialize(),
                    dataType:"json"
                })
                .done(function(data){
                    $("#output").html(
                        "<p>ID : "+data.eid+"</p>"+
                        "<p>Name : "+data.name+"</p>"+
                        "<p>Phone : "+data.phone+"</p>"+
                        "<p>Email : "+data.email+"</p>"+
                        "<p>City : "+data.city+"</p>"+
                        "<p>Country : "+data.country+"</p>"+
                        "<p>Gender : "+data.gender+"</p>"+
                        "<p>Birth Date : "+data.birthday+"</p>"+
                        "<p>Hobbies : "+hby+"</p>"+
                        "<p>Photo :<br/> <img style='width:70%' src='"+data.photo+"'></p>"
                    )
                });
                $('#frmNodeSubmit').trigger("reset");
                $('#photoPreview').attr('src', '');
                return false;
            }
        };
	</script>
    
</head>
<body>
	<form name="frmNodeSubmit" id="frmNodeSubmit" action="/nodesubmit" method="POST" width="80%" accept-charset="utf-8" onsubmit="return validateForm()">
        <h2>Application Form</h2>
        <div class="row mr4">
            <label for="eid">Employee ID</label>
            <input type="text" name="eid" id="eid" autocomplete="off">
            <div class="error" id="eidErr"></div>
        </div>
        <div class="row mr4">
            <label for="fname">First Name</label>
            <input type="text" name="fname" id="fname" autocomplete="off">
            <div class="error" id="fnameErr"></div>
        </div>
        <div class="row">
            <label for="lname">Last Name</label>
            <input type="text" name="lname" id="lname" autocomplete="off">
            <div class="error" id="lnameErr"></div>
        </div>
        <div class="row mr4">
            <label for="phone">Phone Number</label>
            <input type="text" id="phone" name="phone" autocomplete="off" placeholder="01900101010">
            <div class="error" id="phoneErr"></div>
        </div>
        <div class="row">
            <label for="email">Email Address</label>
            <input type="email" id="email" name="email" autocomplete="off" placeholder="abc@abc.com">
            <div class="error" id="emailErr"></div>
        </div>
        <div class="row mr4">
            <label>City</label>
            <select id="city" name="city">
                <option>Select</option>
                <optgroup label="Dhaka">
                    <option>Dhanmondi</option>
                    <option>Mohammadpur</option>
                </optgroup>
                <optgroup label="Chittagong">
                    <option>Alongkar</option>
                    <option>Agrabad</option>
                </optgroup>
            </select>
            <div class="error" id="cityErr"></div>
        </div>
        <div class="row">
            <label>Country</label>
            <input list="country" name="country" placeholder="Select Country" autocomplete="off">
            <datalist id="country">
                <option>Australia</option>
                <option>India</option>
                <option>United States</option>
                <option>United Kingdom</option>
            </datalist>
            <div class="error" id="countryErr"></div>
        </div>
        <div class="row mr4">
            <label>Gender</label>
            <div class="form-inline">
                <label><input type="radio" name="gender" value="male"> Male</label>
                <label><input type="radio" name="gender" value="female"> Female</label>
            </div>
            <div class="error" id="genderErr"></div>
        </div>
        <div class="row">
            <label for="birthday">Date of birth</label>
            <input type="date" id="birthday" name="birthday">
            <div class="error" id="birthdayErr"></div>
        </div>
        <div class="row mr4">
            <label>Hobbies <i>(Optional)</i></label>
            <div class="form-inline">
                <label><input type="checkbox" name="hobbies[]" value="sports"> Sports</label>
                <label><input type="checkbox" name="hobbies[]" value="movies"> Movies</label>
                <label><input type="checkbox" name="hobbies[]" value="music"> Music</label>
            </div>
        </div>
        
        <div class="row" style="height: 150px;float: right;">
        	<label>Photo preview</label>
        	<img id="photoPreview" style="height: 100%;" src="">
        </div>
        <div class="row">
            <label for="photoupload">Photo</label>
            <input type="file" name="photoupload" id="photoupload" 
            onchange="document.getElementById('photoPreview').src = window.URL.createObjectURL(this.files[0]);document.getElementById('photo').value = window.URL.createObjectURL(this.files[0])">
            <input type="hidden" name="photo" id="photo">
            <div class="error" id="photoErr"></div>
        </div>
        
        <div class="row" style="width: 24%; clear: both;">
            <input id="submit" type="Submit" value="Submit">
        </div>
    </form>
    <div class="output">
        <h2>Submitted Data Preview</h2>
    	<p id="output"></p>
    </div>

            
<script type="text/javascript">
    //DOM
   $(".output>h2").css("color","green");
   $(".output").css("background","white");
   $("body").css({"font-family":"'Segoe UI', 'Helvetica Neue', Arial, sans-serif","font-size":".90em"});
</script>

</body>
</html>